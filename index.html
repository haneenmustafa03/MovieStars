<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet">
  <title>Movie Matcher!</title>
  <style>
    #main-screen {
      position: relative;
      z-index: 10;
    }

    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
  </style>
</head>

<body class="bg-gradient-to-r from-blue-500 to-purple-600 flex flex-col items-center justify-center min-h-screen">
  <!-- Main Screen -->
  <div id="main-screen" class="flex flex-col items-center justify-center text-center">
    <h1 class="text-4xl font-bold text-white mb-6 flex items-center">Welcome to Movie Matcher 
      <img src="image/icons8-movie-50.png" alt="Movie Matcher Logo" class="ml-2 w-8 h-8" />
    </h1>
    <div class="space-x-6">
      <button id="find-hashmap-btn" class="px-6 py-3 text-white rounded-lg shadow-lg border-2 border-white transform hover:scale-110 transition duration-300">
        Find Suggestions (Hashmap)
      </button>      
      <button id="find-sortedmap-btn" class="px-6 py-3 text-white rounded-lg shadow-lg border-2 border-white transform hover:scale-110 transition duration-300">
        Find Suggestions (Sorted map)
      </button>
    </div>
  </div>

  <!-- Genome Tags Screen -->
  <div id="genome-tags-screen" style="display: none;">
    <input type="text" id="search-bar" placeholder="Search for a genome..." class="px-4 py-2 rounded-lg border mb-4 w-full max-w-md">

    <h2 class="text-3xl font-semibold text-white mb-4">Select Up to 10 Genome Tags</h2>
    <div id="tags-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"></div>
    <button id="find-suggestions-btn" class="px-6 py-3 bg-purple-500 text-white rounded-lg shadow-lg hover:bg-purple-600">
      Find Suggestions
    </button>
  </div>

  <!-- Suggestions Screen -->
  <div id="suggestions-screen" style="display: none;">
    <h2 class="text-3xl font-semibold text-white mb-4">Top Movie Suggestions</h2>
    <div id="suggestions-container" class="space-y-4"></div>
    <button id="return-btn" class="px-6 py-3 bg-gray-500 text-white rounded-lg shadow-lg hover:bg-gray-600">
      Return to Main Menu
    </button>
  </div>

  <!-- Particles background -->
  <div id="particles-js"></div>

  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
  <script>
    // Store the genome tags globally
    let genomeTags = [];

    // Function to fetch and display all genome tags
    const fetchGenomeTags = () => {
      fetch('http://127.0.0.1:5000/get_genome_tags')
        .then(response => response.json())
        .then(tags => {
          genomeTags = tags; // Save all genome tags to the global variable
          displayTags(tags); // Display all tags initially
        })
        .catch(err => console.error('Error fetching genome tags:', err));
    };

    // Function to display the genome tags
    const displayTags = (tags) => {
      const tagsContainer = document.getElementById('tags-container');
      tagsContainer.innerHTML = ''; // Clear the container before adding new tags

      tags.forEach(tag => {
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = tag;
        checkbox.value = tag;
        checkbox.classList.add('mr-2', 'w-4', 'h-4');

        const label = document.createElement('label');
        label.htmlFor = tag;
        label.textContent = tag;
        label.classList.add('text-sm', 'font-medium', 'text-gray-700');

        const wrapper = document.createElement('div');
        wrapper.classList.add('flex', 'items-center', 'space-x-2');
        wrapper.appendChild(checkbox);
        wrapper.appendChild(label);

        tagsContainer.appendChild(wrapper);
      });
    };

    // Search function to filter genome tags based on user input
    const searchGenomeTags = (event) => {
      const searchTerm = event.target.value.toLowerCase(); // Get the search term and convert it to lowercase
      const filteredTags = genomeTags.filter(tag => tag.toLowerCase().includes(searchTerm)); // Filter tags by search term
      displayTags(filteredTags); // Display the filtered tags
    };

    // Add event listener to search bar
    document.getElementById('search-bar').addEventListener('input', searchGenomeTags);

    // Event listener for button click to fetch genome tags
    document.getElementById('find-hashmap-btn').addEventListener('click', fetchGenomeTags);
    document.getElementById('find-sortedmap-btn').addEventListener('click', fetchGenomeTags);

    // Particles.js setup for the background
    particlesJS('particles-js', {
      "particles": {
        "number": {
          "value": 80,
          "density": {
            "enable": true,
            "value_area": 800
          }
        },
        "color": {
          "value": "#ffffff"
        },
        "shape": {
          "type": "circle"
        },
        "opacity": {
          "value": 0.5,
          "random": true,
          "anim": {
            "enable": true,
            "speed": 1,
            "opacity_min": 0.1
          }
        },
        "size": {
          "value": 5,
          "random": true,
          "anim": {
            "enable": true,
            "speed": 40,
            "size_min": 0.1
          }
        }
      }
    });

    // Fetch genome tags when page loads
    fetchGenomeTags();

  </script>

  <script src="src/app.js"></script>
</body>

</html>